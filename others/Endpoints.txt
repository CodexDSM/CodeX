AUTENTICAÇÃO
Login de Colaborador
POST /api/colaboradores/login

json
{
  "cpf": "123.456.789-00",
  "senha": "senha123",
  "local_trabalho": "Presencial"
}
local_trabalho: Opcional. Valores: Presencial, Home_Office, Evento, Treinamento

Sistema mantém automaticamente os últimos 30 registros por colaborador

COLABORADORES
Listar Colaboradores
GET /api/colaboradores?ativo=true&perfil=Operador

Parâmetros opcionais: ativo (true/false), perfil

Buscar Colaborador por ID
GET /api/colaboradores/:id

Cadastrar Colaborador
POST /api/colaboradores

json
{
  "nome": "José",
  "cpf": "123.456.789-99",
  "email": "jose@empresa.com",
  "senha": "123456",
  "telefone": "11999999999",
  "perfil": "Operador",
  "logradouro": "Rua Teste",
  "numero": "10",
  "complemento": "Apto 1",
  "bairro": "Centro",
  "cidade": "São Paulo",
  "uf": "SP",
  "cep": "01000-000"
}
Atualizar Colaborador
PUT /api/colaboradores/:id

json
{
  "nome": "José da Silva",
  "telefone": "11988887777",
  "perfil": "Gerente",
  "ativo": true,
  "logradouro": "Rua Nova",
  "numero": "15",
  "bairro": "Vila Nova",
  "cidade": "São Paulo",
  "uf": "SP",
  "cep": "01001-000"
}
Alterar Senha
PATCH /api/colaboradores/:id/change-password

json
{
  "senhaAtual": "123456",
  "novaSenha": "nova_senha_123"
}
Desativar Colaborador
DELETE /api/colaboradores/:id

LOCALIZAÇÕES
Headers: Authorization: Bearer TOKEN

Registrar Localização
POST /api/localizacoes

json
{
  "colaborador_id": 1,
  "tipo_localizacao": "Home_Office"
}
Valores válidos: Presencial, Home_Office, Evento, Treinamento

Localização Atual
GET /api/localizacoes/colaborador/:colaborador_id/atual

Histórico de Localizações (últimas 30)
GET /api/localizacoes/colaborador/:colaborador_id/historico

Listar Todas (Admin/Gerente)
GET /api/localizacoes?tipo_localizacao=Presencial&data_inicio=2025-09-01&data_fim=2025-09-30

Estatísticas (Admin/Gerente)
GET /api/localizacoes/estatisticas

CLIENTES
Listar Clientes
GET /api/clientes?tipo_pessoa=F&ativo=true

Buscar por ID
GET /api/clientes/:id

Buscar por Documento
GET /api/clientes/documento/:documento

Criar Cliente
POST /api/clientes

json
{
  "tipo_pessoa": "F",
  "nome": "Maria",
  "documento": "123.456.789-00",
  "email": "maria@email.com",
  "telefone": "11987654321",
  "logradouro": "Av Brasil",
  "numero": "200",
  "bairro": "Bairro Azul",
  "cidade": "São Paulo",
  "uf": "SP",
  "cep": "02000-000"
}
Atualizar Cliente
PUT /api/clientes/:id

Desativar Cliente
DELETE /api/clientes/:id

Listar Interações
GET /api/clientes/:clientId/interactions

Criar Interação
POST /api/clientes/:clientId/interactions

json
{
  "tipo_interacao": "Ligação",
  "data_interacao": "2025-09-17T11:00:00Z",
  "assunto": "Proposta de frete",
  "detalhes": "Cliente solicitou cotação."
}
GENERALIDADES ⭐ NOVO
Headers: Authorization: Bearer TOKEN

Acesso: Administrador, Gerente, Comercial

Listar Generalidades
GET /api/generalidades?ativo=true

Parâmetros opcionais:

ativo - Filtrar por status (true/false)

Resposta:

json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "nome": "Coleta 4h",
      "tipo": "fixo",
      "valor": 150.00,
      "ativo": true,
      "created_at": "2025-10-21T23:00:00.000Z"
    },
    {
      "id": 2,
      "nome": "Seguro",
      "tipo": "porcentagem",
      "valor": 0.70,
      "ativo": true,
      "created_at": "2025-10-21T23:00:00.000Z"
    }
  ]
}
Buscar Generalidade por ID
GET /api/generalidades/:id

Criar Generalidade
POST /api/generalidades

json
{
  "nome": "Coleta Emergencial 2h",
  "tipo": "fixo",
  "valor": 250.00,
  "ativo": true
}
Tipos válidos:

fixo - Valor fixo em R$

porcentagem - Valor em % sobre o frete

Atualizar Generalidade
PUT /api/generalidades/:id

json
{
  "nome": "Coleta 4h",
  "tipo": "fixo",
  "valor": 180.00,
  "ativo": true
}
Deletar Generalidade
DELETE /api/generalidades/:id

Acesso: Apenas Administrador e Gerente

TABELAS DE PREÇOS ⭐ NOVO
Headers: Authorization: Bearer TOKEN

Acesso: Administrador, Gerente, Comercial

Listar Tabelas
GET /api/tabelas-precos?cliente_id=1&tipo_servico=WEAir%20Convencional&ativo=true

Parâmetros opcionais:

cliente_id - Filtrar por cliente

tipo_servico - Filtrar por tipo de serviço

ativo - Filtrar por status

Resposta:

json
{
  "success": true,
  "data": [
    {
      "id": 1,
      "cliente_id": 1,
      "cliente_nome": "Cliente Teste",
      "tipo_servico": "WEAir Convencional",
      "codigo_iata": "GRU",
      "frete_minimo": 350.00,
      "peso_minimo": 10.00,
      "peso_maximo": 300.00,
      "valor_kg_excedente": 8.50,
      "ativo": true,
      "created_at": "2025-10-21T23:00:00.000Z"
    }
  ]
}
Buscar Tabela por ID
GET /api/tabelas-precos/:id

Buscar Tabela Específica
GET /api/tabelas-precos/buscar?cliente_id=1&tipo_servico=WEAir%20Convencional&codigo_iata=GRU

Parâmetros obrigatórios:

cliente_id

tipo_servico

codigo_iata (opcional para serviços rodoviários)

Criar Tabela
POST /api/tabelas-precos

json
{
  "cliente_id": 1,
  "tipo_servico": "WEAir Convencional",
  "codigo_iata": "GRU",
  "frete_minimo": 350.00,
  "peso_minimo": 10.00,
  "peso_maximo": 300.00,
  "valor_kg_excedente": 8.50,
  "ativo": true
}
Tipos de Serviço válidos:

WEAir Convencional

WEAir Expresso

WEAir Proximo Voo

LT WEAir NEWE

WExpress (Rodoviário)

Para WExpress: codigo_iata não é obrigatório

Atualizar Tabela
PUT /api/tabelas-precos/:id

json
{
  "frete_minimo": 380.00,
  "valor_kg_excedente": 9.00,
  "ativo": true
}
Deletar Tabela
DELETE /api/tabelas-precos/:id

Acesso: Apenas Administrador e Gerente

COTAÇÕES
Headers: Authorization: Bearer TOKEN

Acesso: Administrador, Gerente, Comercial

Calcular Cotação ⭐ NOVO
POST /api/cotacoes/calcular

json
{
  "clienteId": 1,
  "tipoServico": "WEAir Convencional",
  "pesoKg": 35.00,
  "kmPercorrido": 430,
  "codigoIata": "GRU",
  "tipoVeiculo": null,
  "generalidadesIds": [1, 2, 3],
  "valorFreteAgregado": 95.00,
  "valorKmAgregado": 0.45
}
Resposta:

json
{
  "success": true,
  "data": {
    "valorBase": 562.50,
    "valorGeneralidades": 172.87,
    "generalidadesDetalhes": [
      {
        "id": 1,
        "nome": "Coleta 4h",
        "tipo": "fixo",
        "valor_original": 150.00,
        "valor_aplicado": 150.00
      },
      {
        "id": 2,
        "nome": "Seguro",
        "tipo": "porcentagem",
        "valor_original": 0.70,
        "valor_aplicado": 3.94
      }
    ],
    "valorCliente": 735.37,
    "valorAgregado": 288.50,
    "valorRentabilidade": 446.87,
    "percentualRentabilidade": 60.77
  }
}
Criar Cotação
POST /api/cotacoes

json
{
  "cliente_id": 1,
  "tipo_servico": "WEAir Convencional",
  "origem": "São Paulo - SP",
  "destino": "Rio de Janeiro - RJ",
  "codigo_iata_destino": "GIG",
  "peso_kg": 35.00,
  "km_percorrido": 430,
  "tipo_veiculo": null,
  "valor_frete_agregado": 95.00,
  "valor_km_agregado": 0.45,
  "valor_base": 562.50,
  "valor_generalidades": 172.87,
  "valor_cliente": 735.37,
  "valor_agregado": 288.50,
  "valor_rentabilidade": 446.87,
  "percentual_rentabilidade": 60.77,
  "generalidades_ids": [1, 2, 3],
  "observacoes": "Carga frágil",
  "enviar_email": true
}
Resposta:

json
{
  "success": true,
  "message": "Cotação criada e email enviado com sucesso!",
  "data": {
    "id": 1,
    "codigo": "COT-2025-0001",
    "pdf_filename": "cotacao-1-1234567890.pdf"
  }
}
Listar Cotações
GET /api/cotacoes?status=Pendente&cliente_id=1&page=1&limit=10

Parâmetros opcionais:

status - Filtrar por status

cliente_id - Filtrar por cliente

page - Página (padrão: 1)

limit - Limite por página (padrão: 10)

Buscar Cotação por ID
GET /api/cotacoes/:id

Buscar por Código
GET /api/cotacoes/codigo/:codigo

Exemplo: /api/cotacoes/codigo/COT-2025-0001

Enviar Cotação por Email
POST /api/cotacoes/:id/enviar

Envia o PDF da cotação por email para o cliente

Atualizar Status
PATCH /api/cotacoes/:id/status

json
{
  "status": "Aprovado"
}
Status válidos: Pendente, Aprovado, Recusado, Expirado

Deletar Cotação
DELETE /api/cotacoes/:id

Acesso: Apenas Administrador e Gerente

AGREGADOS
Cadastrar Agregado (Público)
POST /api/public/agregados

json
{
  "nome_motorista": "José da Silva",
  "cnh": "12345678901",
  "placa_veiculo": "ABC1D23",
  "modelo_veiculo": "Scania R450",
  "telefone": "11987654321",
  "email": "jose@email.com"
}
Cadastrar Agregado (Autenticado)
POST /api/agregados

Headers: Authorization: Bearer TOKEN

Acesso: Administrador, Gerente, Operador

Listar Agregados
GET /api/agregados?page=1&limit=10&search=jose

Headers: Authorization: Bearer TOKEN

Buscar por ID
GET /api/agregados/:id

Buscar por CNH
GET /api/agregados/cnh/:cnh

Buscar por Placa
GET /api/agregados/placa/:placa

Atualizar Agregado
PUT /api/agregados/:id

json
{
  "nome_motorista": "José da Silva",
  "cnh": "12345678901",
  "placa_veiculo": "ABC1D23",
  "modelo_veiculo": "Scania R450 2024",
  "telefone": "11987654999",
  "email": "jose.novo@email.com"
}
Deletar Agregado
DELETE /api/agregados/:id

Acesso: Administrador, Gerente

VEÍCULOS
Listar Veículos
GET /api/veiculos?disponivel=true&tipo=Caminhão

Buscar por ID
GET /api/veiculos/:id

Buscar por Placa
GET /api/veiculos/placa/:placa

Criar Veículo
POST /api/veiculos

json
{
  "placa": "XYZ-1234",
  "modelo": "Mercedes Atego",
  "capacidade_kg": 12000,
  "tipo": "Caminhão"
}
Atualizar Veículo
PUT /api/veiculos/:id

Deletar Veículo
DELETE /api/veiculos/:id

MOTORISTAS
Listar Motoristas
GET /api/motoristas

Listar Disponíveis
GET /api/motoristas/disponiveis

Buscar por ID
GET /api/motoristas/:id

Criar Motorista
POST /api/motoristas

json
{
  "colaborador_id": 2,
  "cnh": "12345678900",
  "categoria_cnh": "E",
  "validade_cnh": "2026-12-31",
  "veiculo_id": 1
}
Atualizar Motorista
PUT /api/motoristas/:id

Deletar Motorista
DELETE /api/motoristas/:id

FRETES
Listar Fretes
GET /api/fretes?status=Transito&data_inicio=2025-01-01&data_fim=2025-12-31

Buscar por ID
GET /api/fretes/:id

Buscar por Código
GET /api/fretes/codigo/:codigo

Criar Frete
POST /api/fretes

json
{
  "cliente_id": 1,
  "motorista_id": 2,
  "veiculo_id": 1,
  "origem_cidade": "São Paulo",
  "origem_uf": "SP",
  "destino_cidade": "Rio de Janeiro",
  "destino_uf": "RJ",
  "distancia_km": 450,
  "valor": 2000.50,
  "peso_kg": 5000,
  "data_coleta": "2025-09-10",
  "data_entrega_prevista": "2025-09-12",
  "observacoes": "Carga frágil"
}
Atualizar Frete
PUT /api/fretes/:id

Atualizar Status
PATCH /api/fretes/:id/status

json
{
  "status": "Entregue"
}
Relatório de Fretes
GET /api/fretes/relatorio?data_inicio=2025-01-01&data_fim=2025-12-31

RASTREAMENTO
Rastreamento Público
GET /api/rastreamento/publico/:codigo

Listar Posições
GET /api/rastreamento/frete/:frete_id

Última Posição
GET /api/rastreamento/frete/:frete_id/ultima

Registrar Posição
POST /api/rastreamento/frete/:frete_id

json
{
  "latitude": -23.550520,
  "longitude": -46.633308
}
CHECKLIST
Upload de Anexo
POST /api/checklist/upload

Content-Type: multipart/form-data

Salvar Checklist
POST /api/checklist/salvar

json
{
  "template_id": 1,
  "colaborador_id": 2,
  "ativo_relacionado_id": 5,
  "respostas": [
    {
      "pergunta_id": 101,
      "valor_resposta": "Conforme"
    }
  ],
  "filePaths": ["uploads/2025-09-23T12-30-00.jpg"]
}
EVENTOS
Headers: Authorization: Bearer TOKEN

Listar Eventos
GET /api/eventos

Buscar por ID
GET /api/eventos/:id

Criar Evento (Admin/Gerente)
POST /api/eventos

json
{
  "titulo": "Reunião de Planejamento",
  "descricao": "Planejamento estratégico",
  "data_inicio": "2025-11-01 09:00:00",
  "data_fim": "2025-11-01 12:00:00",
  "local": "Sala de Conferências"
}
Atualizar Evento (Admin/Gerente)
PUT /api/eventos/:id

Deletar Evento (Admin/Gerente)
DELETE /api/eventos/:id

Listar Eventos do Colaborador
GET /api/eventos/colaborador/:colaborador_id

Aceitar Convite
POST /api/eventos/:evento_id/aceitar

Recusar Convite
POST /api/eventos/:evento_id/recusar

json
{
  "justificativa_recusa": "Conflito de agenda"
}
Marcar como Concluído
POST /api/eventos/:evento_id/concluir

Enviar Feedback
POST /api/eventos/:evento_id/feedback

json
{
  "feedback": "Evento muito produtivo!"
}
NOTIFICAÇÕES
Headers: Authorization: Bearer TOKEN

Criar Notificação (Admin/Gerente)
POST /api/notificacoes

json
{
  "colaborador_id": 2,
  "tipo": "Evento",
  "titulo": "Nova Atualização",
  "mensagem": "Sistema atualizado",
  "evento_id": 1
}
Tipos válidos: Evento, Treinamento, Sistema

Listar Notificações
GET /api/notificacoes?lida=false&tipo=Evento

Contar Não Lidas
GET /api/notificacoes/nao-lidas/count

Buscar por ID
GET /api/notificacoes/:id

Marcar como Lida
PATCH /api/notificacoes/:id/marcar-lida

Marcar Todas como Lidas
PATCH /api/notificacoes/marcar-todas-lidas

Deletar Notificação
DELETE /api/notificacoes/:id